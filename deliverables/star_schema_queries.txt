QUESTION 1: Monthly Encounters by Specialty
SQL QUERY:

```
SELECT
    d.year,
    d.month,
    s.specialty_name,
    f.encounter_type_key,
    COUNT(*) AS total_encounters,
    COUNT(DISTINCT f.patient_key) AS unique_patients
FROM fact_encounters f
JOIN dim_date d
    ON f.date_key = d.date_key
JOIN dim_specialty s
    ON f.specialty_key = s.specialty_key
GROUP BY
    d.year,
    d.month,
    s.specialty_name,
    f.encounter_type_key
ORDER BY
    d.year,
    d.month,
    s.specialty_name,
    f.encounter_type_key;
```

Schema Analysis:
Tables joined: dim_date, dim_specialty, fact_encounters
Number of joins: 2
Performance:
Execution time: 248ms
Estimated rows scanned: fact_encounters has 30,000
Bottleneck Identified:
This query uses the fact and dimension tables in a star schema to calculate monthly encounters by specialty and encounter type. On a 30,000-row dataset, it ran in 248ms. The additional join for encounter types slightly increases execution time compared to a normalized OLTP query.

---

QUESTION 2: Top Diagnosis-Procedure Pairs
SQL QUERY:

```
SELECT
    d.icd10_code,
    p.cpt_code,
    COUNT(*) AS encounter_count
FROM bridge_encounter_diagnoses bd
JOIN bridge_encounter_procedures bp
    ON bd.encounter_key = bp.encounter_key
JOIN dim_diagnosis d
    ON bd.diagnosis_key = d.diagnosis_key
JOIN dim_procedure p
    ON bp.procedure_key = p.procedure_key
GROUP BY
    d.icd10_code,
    p.cpt_code
ORDER BY
    encounter_count DESC;
```

Schema Analysis:
Tables joined: bridge_encounter_diagnoses, bridge_encounter_procedures, dim_diagnosis, dim_procedure
Number of joins: 4
Execution time: 241ms
Performance Improvement:
The star schema reduces row explosion because the fact table has pre-aggregated measures and bridge tables are compact.

---

QUESTION 3: 30-Day Readmission Rate
SQL QUERY:

```
WITH inpatient_encounters AS (
    SELECT
        f.encounter_key,
        f.patient_key,
        f.specialty_key,
        d.calendar_date AS admission_date,
        DATE_ADD(d.calendar_date, INTERVAL f.length_of_stay DAY) AS discharge_date
    FROM fact_encounters f
    JOIN dim_date d
        ON f.date_key = d.date_key
    WHERE f.encounter_type_key = 1  -- Inpatient
),
readmissions AS (
    SELECT
        a.encounter_key AS initial_encounter,
        b.encounter_key AS readmit_encounter,
        a.specialty_key
    FROM inpatient_encounters a
    JOIN inpatient_encounters b
      ON a.patient_key = b.patient_key
     AND b.admission_date > a.discharge_date
     AND b.admission_date <= DATE_ADD(a.discharge_date, INTERVAL 30 DAY)
)
SELECT
    s.specialty_name,
    COUNT(DISTINCT r.readmit_encounter) AS readmissions,
    COUNT(DISTINCT i.encounter_key) AS total_inpatient_encounters,
    ROUND(
        COUNT(DISTINCT r.readmit_encounter) /
        COUNT(DISTINCT i.encounter_key) * 100,
        2
    ) AS readmission_rate_percent
FROM inpatient_encounters i
JOIN dim_specialty s
    ON i.specialty_key = s.specialty_key
LEFT JOIN readmissions r
    ON i.encounter_key = r.initial_encounter
GROUP BY
    s.specialty_name
ORDER BY
    readmission_rate_percent DESC;
```

Schema Analysis:
Tables joined: fact_encounters, dim_date, dim_specialty
Number of joins: 3
Performance:
Execution time: 247ms
Estimated rows scanned: fact_encounters has 30,000
Performance Improvement:
OLAP/star schema is significantly faster than the normalized query. Pre-joined fact tables reduce extra joins, computed discharge dates avoid multiple table lookups, and the self-join is efficient due to dimension keys and compact fact table.

---

QUESTION 4: Revenue by Specialty & Month
SQL QUERY:

```
SELECT
    d.year,
    d.month,
    s.specialty_name,
    SUM(f.total_allowed_amount) AS total_allowed_amount
FROM fact_encounters f
JOIN dim_date d
    ON f.date_key = d.date_key
JOIN dim_specialty s
    ON f.specialty_key = s.specialty_key
GROUP BY
    d.year,
    d.month,
    s.specialty_name
ORDER BY
    d.year,
    d.month,
    total_allowed_amount DESC;
```

Schema Analysis:
Tables joined: fact_encounters, dim_date, dim_specialty
Number of joins: 2
Execution time: 178ms
Estimated rows scanned: fact_encounters has 30,000
Performance Improvement:
Compared to a normalized schema, this star schema query is ~1.93x faster due to fewer joins and pre-aggregated fact tables with surrogate keys in dimensions, reducing intermediate row expansion.

